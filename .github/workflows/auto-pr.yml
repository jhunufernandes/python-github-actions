name: auto-pr
on:
  push:
    branches:
      - 'issue/**'
      - 'development'
permissions:
  contents: write
  pull-requests: write
jobs:
  create-pr-from-issue-branch:
    if: startsWith(github.ref, 'refs/heads/issue/')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Create Pull Request to development
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH_NAME="${GITHUB_REF#refs/heads/}"
          
          # Check if PR already exists
          EXISTING_PR=$(gh pr list --head "$BRANCH_NAME" --base development --state open --json number --jq '.[0].number')
          
          if [ -z "$EXISTING_PR" ]; then
            echo "Creating PR from $BRANCH_NAME to development"
            gh pr create \
              --base development \
              --head "$BRANCH_NAME" \
              --title "Auto PR: $BRANCH_NAME → development" \
              --body "This PR was automatically created from the first push to branch \`$BRANCH_NAME\`."
          else
            echo "PR already exists: #$EXISTING_PR"
          fi
  create-pr-from-development:
    if: github.ref == 'refs/heads/development'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Create Pull Request to main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Check if PR already exists from development to main
          EXISTING_PR=$(gh pr list --head development --base main --state open --json number --jq '.[0].number')
          
          if [ -z "$EXISTING_PR" ]; then
            echo "Creating PR from development to main"
            gh pr create \
              --base main \
              --head development \
              --title "Auto PR: development → main" \
              --body "This PR was automatically created from the first push to the \`development\` branch."
          else
            echo "PR already exists from development to main: #$EXISTING_PR"
          fi
